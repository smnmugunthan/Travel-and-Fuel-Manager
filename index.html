<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Track your bike travels and fuel efficiency">
  <meta name="theme-color" content="#4F46E5">
  <title>Bike Tracker - Track Your Rides & Mileage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <style>
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAFDBwMaw7Zga9cEQ0RuN0uuNmtkrDU4L0",
      authDomain: "bike-travel-and-fuel-manager.firebaseapp.com",
      projectId: "bike-travel-and-fuel-manager",
      storageBucket: "bike-travel-and-fuel-manager.firebasestorage.app",
      messagingSenderId: "633337550155",
      appId: "1:633337550155:web:a8347fe132d290323184ce",
      measurementId: "G-MKTQC8T38S"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // SVG Icons
    const Camera = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path>
        <circle cx="12" cy="13" r="3"></circle>
      </svg>
    );

    const LogOut = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
    );

    const MapPin = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
    );

    const Fuel = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="3" y1="22" x2="15" y2="22"></line>
        <line x1="4" y1="9" x2="14" y2="9"></line>
        <path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"></path>
        <path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"></path>
      </svg>
    );

    const TrendingUp = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const BarChart3 = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 3v18h18"></path>
        <path d="M18 17V9"></path>
        <path d="M13 17V5"></path>
        <path d="M8 17v-3"></path>
      </svg>
    );

    const Users = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    );

    const Check = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    );

    const X = ({ size = 20 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Loader = ({ size = 20 }) => (
      <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="2" x2="12" y2="6"></line>
        <line x1="12" y1="18" x2="12" y2="22"></line>
        <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
        <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
        <line x1="2" y1="12" x2="6" y2="12"></line>
        <line x1="18" y1="12" x2="22" y2="12"></line>
        <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
        <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
      </svg>
    );

    function BikeTrackerApp() {
      const [currentUser, setCurrentUser] = useState(null);
      const [userProfile, setUserProfile] = useState(null);
      const [isAdmin, setIsAdmin] = useState(false);
      const [authMode, setAuthMode] = useState('login');
      const [loading, setLoading] = useState(true);
      
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');
      
      const [activeTab, setActiveTab] = useState('dashboard');
      const [trips, setTrips] = useState([]);
      const [fuelEntries, setFuelEntries] = useState([]);
      const [pendingUsers, setPendingUsers] = useState([]);
      
      const [tripForm, setTripForm] = useState({
        source: '',
        destination: '',
        kilometers: '',
        date: new Date().toISOString().slice(0, 16),
        notes: ''
      });
      
      const [fuelForm, setFuelForm] = useState({
        entryType: 'startEnd',
        startKm: '',
        endKm: '',
        totalKm: '',
        liters: '',
        cost: '',
        partialFill: false,
        date: new Date().toISOString().slice(0, 16),
        notes: ''
      });

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(async (user) => {
          if (user) {
            setCurrentUser(user);
            await loadUserProfile(user.uid);
            await loadUserData(user.uid);
          } else {
            setCurrentUser(null);
            setUserProfile(null);
            setIsAdmin(false);
            setTrips([]);
            setFuelEntries([]);
          }
          setLoading(false);
        });

        return () => unsubscribe();
      }, []);

      const loadUserProfile = async (userId) => {
        try {
          const userDoc = await db.collection('users').doc(userId).get();
          if (userDoc.exists) {
            const userData = userDoc.data();
            setUserProfile(userData);
            setIsAdmin(userData.role === 'admin');
            
            if (userData.role === 'admin') {
              loadPendingUsers();
            }
          }
        } catch (err) {
          console.error('Error loading user profile:', err);
        }
      };

      const loadUserData = async (userId) => {
        try {
          console.log('Loading trips for user:', userId);
          
          // Load trips
          const unsubscribeTrips = db.collection('trips').where('userId', '==', userId)
            .onSnapshot((snapshot) => {
              console.log('Trips snapshot received:', snapshot.docs.length, 'documents');
              const tripsData = snapshot.docs.map(doc => {
                const data = doc.data();
                console.log('Trip document:', doc.id, data);
                return {
                  id: doc.id,
                  ...data
                };
              });
              // Sort in memory instead
              tripsData.sort((a, b) => new Date(b.date) - new Date(a.date));
              console.log('Setting trips state:', tripsData);
              setTrips(tripsData);
            }, (err) => {
              console.error('Error loading trips:', err);
              setError('Error loading trips: ' + err.message);
            });

          console.log('Loading fuel entries for user:', userId);
          
          // Load fuel entries
          const unsubscribeFuel = db.collection('fuel').where('userId', '==', userId)
            .onSnapshot((snapshot) => {
              console.log('Fuel snapshot received:', snapshot.docs.length, 'documents');
              const fuelData = snapshot.docs.map(doc => {
                const data = doc.data();
                console.log('Fuel document:', doc.id, data);
                return {
                  id: doc.id,
                  ...data
                };
              });
              // Sort in memory instead
              fuelData.sort((a, b) => new Date(b.date) - new Date(a.date));
              console.log('Setting fuel state:', fuelData);
              setFuelEntries(fuelData);
            }, (err) => {
              console.error('Error loading fuel entries:', err);
              setError('Error loading fuel entries: ' + err.message);
            });
        } catch (err) {
          console.error('Error in loadUserData:', err);
          setError('Error loading data: ' + err.message);
        }
      };

      const loadPendingUsers = async () => {
        try {
          db.collection('users').where('status', '==', 'pending')
            .onSnapshot((snapshot) => {
              const pendingData = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
              }));
              setPendingUsers(pendingData);
            });
        } catch (err) {
          console.error('Error loading pending users:', err);
        }
      };

      const handleRegister = async (e) => {
        e.preventDefault();
        setError('');
        setSuccess('');
        setLoading(true);

        try {
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          const user = userCredential.user;

          const usersSnapshot = await db.collection('users').get();
          const isFirstUser = usersSnapshot.empty;

          await db.collection('users').doc(user.uid).set({
            email: email,
            name: name,
            role: isFirstUser ? 'admin' : 'user',
            status: isFirstUser ? 'approved' : 'pending',
            createdAt: new Date().toISOString()
          });

          if (isFirstUser) {
            setSuccess('Admin account created successfully!');
          } else {
            setAuthMode('pending');
            await auth.signOut();
            setSuccess('Registration submitted! Please wait for admin approval.');
          }
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          const userCredential = await auth.signInWithEmailAndPassword(email, password);
          const user = userCredential.user;

          const userDoc = await db.collection('users').doc(user.uid).get();
          if (!userDoc.exists) {
            await auth.signOut();
            setError('User profile not found. Please contact admin.');
            setLoading(false);
            return;
          }

          const userData = userDoc.data();
          if (userData.status === 'pending') {
            await auth.signOut();
            setError('Your account is pending approval. Please wait for admin to approve.');
            setLoading(false);
            return;
          }

          if (userData.status === 'rejected') {
            await auth.signOut();
            setError('Your account has been rejected. Please contact admin.');
            setLoading(false);
            return;
          }
        } catch (err) {
          setError(err.message);
          setLoading(false);
        }
      };

      const handleLogout = async () => {
        try {
          await auth.signOut();
          setEmail('');
          setPassword('');
          setName('');
          setActiveTab('dashboard');
        } catch (err) {
          setError(err.message);
        }
      };

      const handleAddTrip = async (e) => {
        e.preventDefault();
        setError('');
        setSuccess('');
        setLoading(true);

        try {
          console.log('Adding trip...', {
            userId: currentUser.uid,
            source: tripForm.source,
            destination: tripForm.destination,
            kilometers: parseFloat(tripForm.kilometers),
            date: tripForm.date,
            notes: tripForm.notes
          });

          const docRef = await db.collection('trips').add({
            userId: currentUser.uid,
            source: tripForm.source,
            destination: tripForm.destination,
            kilometers: parseFloat(tripForm.kilometers),
            date: tripForm.date,
            notes: tripForm.notes,
            createdAt: new Date().toISOString()
          });

          console.log('Trip added successfully with ID:', docRef.id);

          setTripForm({
            source: '',
            destination: '',
            kilometers: '',
            date: new Date().toISOString().slice(0, 16),
            notes: ''
          });
          setSuccess('Trip added successfully!');
          setActiveTab('trips');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          console.error('Error adding trip:', err);
          setError('Error adding trip: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleAddFuel = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          const fuelData = {
            userId: currentUser.uid,
            entryType: fuelForm.entryType,
            liters: parseFloat(fuelForm.liters),
            cost: parseFloat(fuelForm.cost),
            partialFill: fuelForm.partialFill,
            date: fuelForm.date,
            notes: fuelForm.notes,
            createdAt: new Date().toISOString()
          };

          if (fuelForm.entryType === 'startEnd') {
            fuelData.startKm = parseFloat(fuelForm.startKm);
            fuelData.endKm = parseFloat(fuelForm.endKm);
          } else {
            fuelData.totalKm = parseFloat(fuelForm.totalKm);
          }

          await db.collection('fuel').add(fuelData);

          setFuelForm({
            entryType: 'startEnd',
            startKm: '',
            endKm: '',
            totalKm: '',
            liters: '',
            cost: '',
            partialFill: false,
            date: new Date().toISOString().slice(0, 16),
            notes: ''
          });
          setSuccess('Fuel entry added successfully!');
          setActiveTab('fuel');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      const deleteTrip = async (id) => {
        if (!window.confirm('Are you sure you want to delete this trip?')) return;
        
        try {
          await db.collection('trips').doc(id).delete();
          setSuccess('Trip deleted successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const deleteFuel = async (id) => {
        if (!window.confirm('Are you sure you want to delete this fuel entry?')) return;
        
        try {
          await db.collection('fuel').doc(id).delete();
          setSuccess('Fuel entry deleted successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const approveUser = async (userId) => {
        try {
          await db.collection('users').doc(userId).update({
            status: 'approved',
            approvedAt: new Date().toISOString()
          });
          setSuccess('User approved successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const rejectUser = async (userId) => {
        if (!window.confirm('Are you sure you want to reject this user?')) return;
        
        try {
          await db.collection('users').doc(userId).update({
            status: 'rejected',
            rejectedAt: new Date().toISOString()
          });
          setSuccess('User rejected.');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const getCurrentOdometer = () => {
        let maxKm = 0;
        fuelEntries.forEach(entry => {
          if (entry.entryType === 'startEnd' && entry.endKm > maxKm) {
            maxKm = entry.endKm;
          }
        });
        return maxKm;
      };

      const calculateAverageMileage = () => {
         if (fuelEntries.length === 0) return 0;
        
        let totalKm = 0;
        let totalLiters = 0;
        
        fuelEntries.forEach(entry => {
          if (entry.entryType === 'startEnd') {
            totalKm += (entry.endKm - entry.startKm);
          } else {
            totalKm += entry.totalKm;
          }
          totalLiters += entry.liters;
        });
        
        return totalLiters > 0 ? (totalKm / totalLiters).toFixed(2) : 0;
      };

      const totalTrips = trips.length;
      const totalKmTraveled = trips.reduce((sum, t) => sum + t.kilometers, 0);
      const totalFuelCost = fuelEntries.reduce((sum, f) => sum + f.cost, 0);
      const totalFuelLiters = fuelEntries.reduce((sum, f) => sum + f.liters, 0);
      const avgMileage = calculateAverageMileage();
      const currentOdometer = getCurrentOdometer();

      if (loading && !currentUser && authMode === 'login') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
            <div className="text-center">
              <Loader size={48} />
              <p className="text-gray-600 mt-4">Loading...</p>
            </div>
          </div>
        );
      }

      if (!currentUser) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
              <div className="text-center mb-8">
                <div className="inline-flex items-center justify-center w-16 h-16 bg-indigo-600 rounded-full mb-4 text-white">
                  <Camera />
                </div>
                <h1 className="text-3xl font-bold text-gray-800">Bike Tracker</h1>
                <p className="text-gray-600 mt-2">Track your rides & mileage</p>
              </div>

              {success && (
                <div className="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4 text-sm">
                  {success}
                </div>
              )}

              {error && (
                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">
                  {error}
                </div>
              )}

              {authMode === 'pending' ? (
                <div className="text-center py-8">
                  <div className="inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-full mb-4 text-yellow-600">
                    <Check size={32} />
                  </div>
                  <h2 className="text-xl font-semibold text-gray-800 mb-2">Registration Submitted!</h2>
                  <p className="text-gray-600 mb-6">Your account is pending admin approval.</p>
                  <button
                    onClick={() => { setAuthMode('login'); setSuccess(''); setError(''); }}
                    className="text-indigo-600 hover:text-indigo-700 font-medium"
                  >
                    Back to Login
                  </button>
                </div>
              ) : (
                <>
                  <div className="flex border-b mb-6">
                    <button
                      onClick={() => { setAuthMode('login'); setError(''); setSuccess(''); }}
                      className={`flex-1 py-2 text-center font-medium ${
                        authMode === 'login'
                          ? 'text-indigo-600 border-b-2 border-indigo-600'
                          : 'text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      Login
                    </button>
                    <button
                      onClick={() => { setAuthMode('register'); setError(''); setSuccess(''); }}
                      className={`flex-1 py-2 text-center font-medium ${
                        authMode === 'register'
                          ? 'text-indigo-600 border-b-2 border-indigo-600'
                          : 'text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      Register
                    </button>
                  </div>

                  <form onSubmit={authMode === 'login' ? handleLogin : handleRegister}>
                    {authMode === 'register' && (
                      <div className="mb-4">
                        <label className="block text-gray-700 font-medium mb-2">Name</label>
                        <input
                          type="text"
                          value={name}
                          onChange={(e) => setName(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          required
                        />
                      </div>
                    )}

                    <div className="mb-4">
                      <label className="block text-gray-700 font-medium mb-2">Email</label>
                      <input
                        type="email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        required
                      />
                    </div>

                    <div className="mb-6">
                      <label className="block text-gray-700 font-medium mb-2">Password</label>
                      <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        required
                        minLength="6"
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center"
                    >
                      {loading ? <Loader size={20} /> : (authMode === 'login' ? 'Login' : 'Register')}
                    </button>
                  </form>
                </>
              )}
            </div>
          </div>
        );
      }

      // Main App - Logged In
      return (
        <div className="min-h-screen bg-gray-50">
          {/* Header */}
          <header className="bg-white shadow-sm sticky top-0 z-10">
            <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center space-x-3">
                <div className="text-indigo-600">
                  <Camera />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-gray-800">Bike Tracker</h1>
                  <p className="text-xs text-gray-500">Odometer: {currentOdometer} km</p>
                </div>
              </div>
              <div className="flex items-center space-x-4">
                <div className="hidden md:block text-right">
                  <p className="text-sm font-medium text-gray-800">{userProfile?.name}</p>
                  <p className="text-xs text-gray-500">{isAdmin ? 'Admin' : 'User'}</p>
                </div>
                <button
                  onClick={handleLogout}
                  className="p-2 text-gray-600 hover:text-red-600 transition-colors"
                  title="Logout"
                >
                  <LogOut />
                </button>
              </div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-4 py-6">
            {/* Messages */}
            {success && (
              <div className="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4">
                {success}
              </div>
            )}
            
            {error && (
              <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4">
                {error}
              </div>
            )}

            {/* Navigation */}
            <div className="bg-white rounded-xl shadow-sm mb-6 overflow-x-auto">
              <div className="flex border-b">
                <button
                  onClick={() => setActiveTab('dashboard')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 ${
                    activeTab === 'dashboard'
                      ? 'text-indigo-600 border-b-2 border-indigo-600'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  <BarChart3 size={18} />
                  <span className="hidden sm:inline">Dashboard</span>
                </button>
                <button
                  onClick={() => setActiveTab('addTrip')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 ${
                    activeTab === 'addTrip'
                      ? 'text-indigo-600 border-b-2 border-indigo-600'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  <MapPin size={18} />
                  <span>Add Trip</span>
                </button>
                <button
                  onClick={() => setActiveTab('addFuel')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 ${
                    activeTab === 'addFuel'
                      ? 'text-indigo-600 border-b-2 border-indigo-600'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  <Fuel size={18} />
                  <span>Add Fuel</span>
                </button>
                <button
                  onClick={() => setActiveTab('trips')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap ${
                    activeTab === 'trips'
                      ? 'text-indigo-600 border-b-2 border-indigo-600'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  <span>Trips ({totalTrips})</span>
                </button>
                <button
                  onClick={() => setActiveTab('fuel')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap ${
                    activeTab === 'fuel'
                      ? 'text-indigo-600 border-b-2 border-indigo-600'
                      : 'text-gray-600 hover:text-gray-800'
                  }`}
                >
                  <span>Fuel ({fuelEntries.length})</span>
                </button>
                {isAdmin && (
                  <button
                    onClick={() => setActiveTab('users')}
                    className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 ${
                      activeTab === 'users'
                        ? 'text-indigo-600 border-b-2 border-indigo-600'
                        : 'text-gray-600 hover:text-gray-800'
                    }`}
                  >
                    <Users size={18} />
                    <span>Users {pendingUsers.length > 0 && `(${pendingUsers.length})`}</span>
                  </button>
                )}
              </div>
            </div>

            {/* Dashboard */}
            {activeTab === 'dashboard' && (
              <div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                  <div className="bg-white rounded-xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm font-medium">Avg Mileage</h3>
                      <TrendingUp size={20} />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">{avgMileage}</p>
                    <p className="text-sm text-gray-500">km/liter</p>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm font-medium">Total Trips</h3>
                      <MapPin size={20} />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">{totalTrips}</p>
                    <p className="text-sm text-gray-500">{totalKmTraveled.toFixed(1)} km traveled</p>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm font-medium">Fuel Consumed</h3>
                      <Fuel size={20} />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">{totalFuelLiters.toFixed(1)}</p>
                    <p className="text-sm text-gray-500">liters</p>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm font-medium">Total Cost</h3>
                      <span className="text-purple-600 font-bold text-xl">₹</span>
                    </div>
                    <p className="text-3xl font-bold text-gray-800">₹{totalFuelCost.toFixed(0)}</p>
                    <p className="text-sm text-gray-500">fuel expenses</p>
                  </div>
                </div>

                <div className="bg-white rounded-xl shadow-sm p-6">
                  <h2 className="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h2>
                  {trips.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">No trips recorded yet. Add your first trip!</p>
                  ) : (
                    trips.slice(0, 5).map(trip => (
                      <div key={trip.id} className="flex items-center justify-between py-3 border-b last:border-b-0">
                        <div>
                          <p className="font-medium text-gray-800">{trip.source} → {trip.destination}</p>
                          <p className="text-sm text-gray-500">{new Date(trip.date).toLocaleString()}</p>
                        </div>
                        <div className="text-right">
                          <p className="font-semibold text-indigo-600">{trip.kilometers} km</p>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}

            {/* Add Trip Form */}
            {activeTab === 'addTrip' && (
              <div className="bg-white rounded-xl shadow-sm p-6 max-w-2xl mx-auto">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">Add New Trip</h2>
                <form onSubmit={handleAddTrip}>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Source Location</label>
                      <input
                        type="text"
                        value={tripForm.source}
                        onChange={(e) => setTripForm({...tripForm, source: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Destination Location</label>
                      <input
                        type="text"
                        value={tripForm.destination}
                        onChange={(e) => setTripForm({...tripForm, destination: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Kilometers Traveled</label>
                      <input
                        type="number"
                        step="0.1"
                        value={tripForm.kilometers}
                        onChange={(e) => setTripForm({...tripForm, kilometers: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Date & Time</label>
                      <input
                        type="datetime-local"
                        value={tripForm.date}
                        onChange={(e) => setTripForm({...tripForm, date: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Notes (Optional)</label>
                      <textarea
                        value={tripForm.notes}
                        onChange={(e) => setTripForm({...tripForm, notes: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        rows="3"
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:bg-gray-400 flex items-center justify-center"
                    >
                      {loading ? <Loader size={20} /> : 'Add Trip'}
                    </button>
                  </div>
                </form>
              </div>
            )}

            {/* Add Fuel Form */}
            {activeTab === 'addFuel' && (
              <div className="bg-white rounded-xl shadow-sm p-6 max-w-2xl mx-auto">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">Add Fuel Entry</h2>
                <form onSubmit={handleAddFuel}>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Entry Type</label>
                      <div className="flex space-x-4">
                        <label className="flex items-center">
                          <input
                            type="radio"
                            value="startEnd"
                            checked={fuelForm.entryType === 'startEnd'}
                            onChange={(e) => setFuelForm({...fuelForm, entryType: e.target.value})}
                            className="mr-2"
                          />
                          <span>Start/End KM</span>
                        </label>
                        <label className="flex items-center">
                          <input
                            type="radio"
                            value="totalKm"
                            checked={fuelForm.entryType === 'totalKm'}
                            onChange={(e) => setFuelForm({...fuelForm, entryType: e.target.value})}
                            className="mr-2"
                          />
                          <span>Total KM</span>
                        </label>
                      </div>
                    </div>

                    {fuelForm.entryType === 'startEnd' ? (
                      <>
                        <div>
                          <label className="block text-gray-700 font-medium mb-2">Start Odometer (km)</label>
                          <input
                            type="number"
                            step="0.1"
                            value={fuelForm.startKm}
                            onChange={(e) => setFuelForm({...fuelForm, startKm: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            required
                          />
                        </div>
                        <div>
                          <label className="block text-gray-700 font-medium mb-2">End Odometer (km)</label>
                          <input
                            type="number"
                            step="0.1"
                            value={fuelForm.endKm}
                            onChange={(e) => setFuelForm({...fuelForm, endKm: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            required
                          />
                        </div>
                      </>
                    ) : (
                      <div>
                        <label className="block text-gray-700 font-medium mb-2">Total Kilometers</label>
                        <input
                          type="number"
                          step="0.1"
                          value={fuelForm.totalKm}
                          onChange={(e) => setFuelForm({...fuelForm, totalKm: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                          required
                        />
                      </div>
                    )}

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Fuel Amount (liters)</label>
                      <input
                        type="number"
                        step="0.01"
                        value={fuelForm.liters}
                        onChange={(e) => setFuelForm({...fuelForm, liters: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Cost (₹)</label>
                      <input
                        type="number"
                        step="0.01"
                        value={fuelForm.cost}
                        onChange={(e) => setFuelForm({...fuelForm, cost: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="flex items-center">
                        <input
                          type="checkbox"
                          checked={fuelForm.partialFill}
                          onChange={(e) => setFuelForm({...fuelForm, partialFill: e.target.checked})}
                          className="mr-2"
                        />
                        <span className="text-gray-700">Partial Fill (Not full tank)</span>
                      </label>
                      <p className="text-xs text-gray-500 mt-1">Check this if you didn't fill the tank completely</p>
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Date & Time</label>
                      <input
                        type="datetime-local"
                        value={fuelForm.date}
                        onChange={(e) => setFuelForm({...fuelForm, date: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2">Notes (Optional)</label>
                      <textarea
                        value={fuelForm.notes}
                        onChange={(e) => setFuelForm({...fuelForm, notes: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                        rows="3"
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors disabled:bg-gray-400 flex items-center justify-center"
                    >
                      {loading ? <Loader size={20} /> : 'Add Fuel Entry'}
                    </button>
                  </div>
                </form>
              </div>
            )}

            {/* Trip History */}
            {activeTab === 'trips' && (
              <div className="bg-white rounded-xl shadow-sm p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">Trip History</h2>
                {trips.length === 0 ? (
                  <div className="text-center py-12 text-gray-500">
                    <div className="flex justify-center mb-4">
                      <MapPin size={48} />
                    </div>
                    <p>No trips recorded yet</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {trips.map(trip => (
                      <div key={trip.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div className="flex items-start justify-between mb-2">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2 mb-1">
                              <MapPin size={20} />
                              <h3 className="font-semibold text-gray-800">{trip.source} → {trip.destination}</h3>
                            </div>
                            <p className="text-sm text-gray-600">{new Date(trip.date).toLocaleString()}</p>
                            {trip.notes && <p className="text-sm text-gray-500 mt-2 italic">{trip.notes}</p>}
                          </div>
                          <div className="flex items-center space-x-2">
                            <span className="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-semibold text-sm">
                              {trip.kilometers} km
                            </span>
                            <button
                              onClick={() => deleteTrip(trip.id)}
                              className="text-red-500 hover:text-red-700 p-1"
                              title="Delete"
                            >
                              <X size={20} />
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Fuel History */}
            {activeTab === 'fuel' && (
              <div className="bg-white rounded-xl shadow-sm p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">Fuel History</h2>
                {fuelEntries.length === 0 ? (
                  <div className="text-center py-12 text-gray-500">
                    <div className="flex justify-center mb-4">
                      <Fuel size={48} />
                    </div>
                    <p>No fuel entries recorded yet</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {fuelEntries.map(fuel => {
                      const km = fuel.entryType === 'startEnd' 
                        ? (fuel.endKm - fuel.startKm) 
                        : fuel.totalKm;
                      const mileage = (km / fuel.liters).toFixed(2);
                      const pricePerLiter = (fuel.cost / fuel.liters).toFixed(2);
                      
                      return (
                        <div key={fuel.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex-1">
                              <div className="flex items-center space-x-2 mb-1 flex-wrap">
                                <Fuel size={20} />
                                <h3 className="font-semibold text-gray-800">
                                  {fuel.entryType === 'startEnd' 
                                    ? `${fuel.startKm} → ${fuel.endKm} km` 
                                    : `${fuel.totalKm} km traveled`}
                                </h3>
                                {fuel.partialFill && (
                                  <span className="bg-yellow-100 text-yellow-700 text-xs px-2 py-1 rounded">
                                    Partial Fill
                                  </span>
                                )}
                              </div>
                              <p className="text-sm text-gray-600">{new Date(fuel.date).toLocaleString()}</p>
                              {fuel.notes && <p className="text-sm text-gray-500 mt-2 italic">{fuel.notes}</p>}
                            </div>
                            <button
                              onClick={() => deleteFuel(fuel.id)}
                              className="text-red-500 hover:text-red-700 p-1"
                              title="Delete"
                            >
                              <X size={20} />
                            </button>
                          </div>
                          
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 pt-3 border-t border-gray-100">
                            <div>
                              <p className="text-xs text-gray-500">Distance</p>
                              <p className="font-semibold text-gray-800">{km} km</p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Fuel</p>
                              <p className="font-semibold text-gray-800">{fuel.liters} L</p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Cost</p>
                              <p className="font-semibold text-gray-800">₹{fuel.cost}</p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Mileage</p>
                              <p className="font-semibold text-green-600">{mileage} km/L</p>
                            </div>
                          </div>
                          <div className="mt-2 text-xs text-gray-500">
                            Price per liter: ₹{pricePerLiter}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            )}

            {/* User Management */}
            {activeTab === 'users' && isAdmin && (
              <div className="bg-white rounded-xl shadow-sm p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">User Management</h2>
                
                {pendingUsers.length > 0 ? (
                  <div className="mb-8">
                    <h3 className="text-lg font-semibold text-gray-700 mb-4">Pending Approvals</h3>
                    <div className="space-y-3">
                      {pendingUsers.map(user => (
                        <div key={user.id} className="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-yellow-200 bg-yellow-50 rounded-lg gap-3">
                          <div>
                            <p className="font-medium text-gray-800">{user.name}</p>
                            <p className="text-sm text-gray-600">{user.email}</p>
                            <p className="text-xs text-gray-500 mt-1">Registered: {new Date(user.createdAt).toLocaleDateString()}</p>
                          </div>
                          <div className="flex space-x-2">
                            <button
                              onClick={() => approveUser(user.id)}
                              className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-1"
                            >
                              <Check size={16} />
                              <span>Approve</span>
                            </button>
                            <button
                              onClick={() => rejectUser(user.id)}
                              className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center space-x-1"
                            >
                              <X size={16} />
                              <span>Reject</span>
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-12 text-gray-500">
                    <div className="flex justify-center mb-4">
                      <Users size={48} />
                    </div>
                    <p>No pending user requests</p>
                  </div>
                )}

                <div className="mt-8 p-4 bg-blue-50 rounded-lg">
                  <h4 className="font-semibold text-blue-900 mb-2">Admin Info</h4>
                  <p className="text-sm text-blue-800">You can approve or reject user registration requests here.</p>
                  <p className="text-sm text-blue-800 mt-1">Approved users will be able to login and track their bike data.</p>
                  <p className="text-sm text-blue-800 mt-1">Each user can only see their own trips and fuel entries.</p>
                </div>
              </div>
            )}
          </div>

          {/* Footer */}
          <footer className="bg-white border-t mt-12 py-6">
            <div className="max-w-7xl mx-auto px-4 text-center text-sm text-gray-600">
              <p>Bike Travel & Mileage Tracker</p>
              <p className="mt-1 text-xs text-gray-500">
                Built with React & Firebase • Connected to: {firebaseConfig.projectId}
              </p>
            </div>
          </footer>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BikeTrackerApp />);
  </script>
</body>
</html>
