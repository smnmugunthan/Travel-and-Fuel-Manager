<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Complete bike tracking with trips, fuel, service, and maintenance">
  <meta name="theme-color" content="#4F46E5">
  <title>Bike Tracker - Complete Solution</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <style>
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .slide-in { animation: slideIn 0.3s ease-out; }
    .glassmorphism { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAFDBwMaw7Zga9cEQ0RuN0uuNmtkrDU4L0",
      authDomain: "bike-travel-and-fuel-manager.firebaseapp.com",
      projectId: "bike-travel-and-fuel-manager",
      storageBucket: "bike-travel-and-fuel-manager.firebasestorage.app",
      messagingSenderId: "633337550155",
      appId: "1:633337550155:web:a8347fe132d290323184ce",
      measurementId: "G-MKTQC8T38S"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // SVG Icons
    const Icon = ({ name, size = 20, className = "" }) => {
      const icons = {
        camera: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>,
        logout: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
        map: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
        fuel: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><line x1="3" y1="22" x2="15" y2="22"></line><line x1="4" y1="9" x2="14" y2="9"></line><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"></path><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"></path></svg>,
        trending: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
        chart: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M3 3v18h18"></path><path d="M18 17V9"></path><path d="M13 17V5"></path><path d="M8 17v-3"></path></svg>,
        users: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
        check: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
        x: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
        loader: <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>,
        wrench: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>,
        list: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>,
        bell: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>,
        alert: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
        settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m0-18h0m0 0h0"></path></svg>,
        plus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
        edit: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
        trash: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
        bike: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><circle cx="5.5" cy="17.5" r="3.5"></circle><circle cx="18.5" cy="17.5" r="3.5"></circle><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path><path d="M12 17.5V14l-3-3 4-3 2 3h2"></path></svg>
      };
      return icons[name] || null;
    };

    function BikeTrackerApp() {
      // Auth State
      const [currentUser, setCurrentUser] = useState(null);
      const [userProfile, setUserProfile] = useState(null);
      const [isAdmin, setIsAdmin] = useState(false);
      const [authMode, setAuthMode] = useState('login');
      
      // Form States
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [bikeName, setBikeName] = useState('');
      const [bikeModel, setBikeModel] = useState('');
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');
      const [loading, setLoading] = useState(true);
      
      // App State
      const [activeTab, setActiveTab] = useState('dashboard');
      const [activeBike, setActiveBike] = useState(null);
      const [bikes, setBikes] = useState([]);
      const [trips, setTrips] = useState([]);
      const [fuelEntries, setFuelEntries] = useState([]);
      const [serviceEntries, setServiceEntries] = useState([]);
      const [checklists, setChecklists] = useState([]);
      const [issues, setIssues] = useState([]);
      const [pendingUsers, setPendingUsers] = useState([]);

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(async (user) => {
          if (user) {
            setCurrentUser(user);
            await loadUserProfile(user.uid);
          } else {
            setCurrentUser(null);
            setUserProfile(null);
            setIsAdmin(false);
          }
          setLoading(false);
        });
        return () => unsubscribe();
      }, []);

      const loadUserProfile = async (userId) => {
        try {
          const userDoc = await db.collection('users').doc(userId).get();
          if (userDoc.exists) {
            const userData = userDoc.data();
            setUserProfile(userData);
            setIsAdmin(userData.role === 'admin');
            
            // Load bikes
            const bikesSnapshot = await db.collection('bikes').where('userId', '==', userId).get();
            const bikesData = bikesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setBikes(bikesData);
            
            if (bikesData.length > 0) {
              const active = bikesData.find(b => b.active) || bikesData[0];
              setActiveBike(active);
              await loadBikeData(userId, active.id);
            }
            
            if (userData.role === 'admin') {
              loadPendingUsers();
            }
          }
        } catch (err) {
          console.error('Error loading user profile:', err);
        }
      };

      const loadBikeData = async (userId, bikeId) => {
        try {
          // Load trips
          db.collection('trips')
            .where('userId', '==', userId)
            .where('bikeId', '==', bikeId)
            .onSnapshot((snapshot) => {
              const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              data.sort((a, b) => new Date(b.date) - new Date(a.date));
              setTrips(data);
            });

          // Load fuel
          db.collection('fuel')
            .where('userId', '==', userId)
            .where('bikeId', '==', bikeId)
            .onSnapshot((snapshot) => {
              const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              data.sort((a, b) => new Date(b.date) - new Date(a.date));
              setFuelEntries(data);
            });

          // Load services if enabled
          if (userProfile?.features?.serviceTrackingEnabled) {
            db.collection('services')
              .where('userId', '==', userId)
              .where('bikeId', '==', bikeId)
              .onSnapshot((snapshot) => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setServiceEntries(data);
              });
          }

          // Load issues if enabled
          if (userProfile?.features?.issueTrackingEnabled) {
            db.collection('issues')
              .where('userId', '==', userId)
              .where('bikeId', '==', bikeId)
              .onSnapshot((snapshot) => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setIssues(data);
              });
          }

          // Load checklists if enabled
          if (userProfile?.features?.checklistsEnabled) {
            db.collection('checklists')
              .where('userId', '==', userId)
              .onSnapshot((snapshot) => {
                const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setChecklists(data);
              });
          }
        } catch (err) {
          console.error('Error loading bike data:', err);
        }
      };

      const loadPendingUsers = async () => {
        try {
          db.collection('users').where('status', '==', 'pending')
            .onSnapshot((snapshot) => {
              const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
              setPendingUsers(data);
            });
        } catch (err) {
          console.error('Error loading pending users:', err);
        }
      };

      const handleRegister = async (e) => {
        e.preventDefault();
        setError('');
        setSuccess('');
        setLoading(true);

        try {
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          const user = userCredential.user;

          const usersSnapshot = await db.collection('users').get();
          const isFirstUser = usersSnapshot.empty;

          await db.collection('users').doc(user.uid).set({
            email: email,
            name: name,
            role: isFirstUser ? 'admin' : 'user',
            status: isFirstUser ? 'approved' : 'pending',
            features: {
              serviceTrackingEnabled: true,
              checklistsEnabled: false,
              remindersEnabled: false,
              issueTrackingEnabled: true
            },
            createdAt: new Date().toISOString()
          });

          // Create first bike
          if (bikeName && bikeModel) {
            await db.collection('bikes').add({
              userId: user.uid,
              bikeName: bikeName,
              bikeModel: bikeModel,
              startingOdometer: 0,
              currentOdometer: 0,
              active: true,
              createdAt: new Date().toISOString()
            });
          }

          if (isFirstUser) {
            setSuccess('Admin account created successfully!');
          } else {
            setAuthMode('pending');
            await auth.signOut();
            setSuccess('Registration submitted! Please wait for admin approval.');
          }
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
          const userCredential = await auth.signInWithEmailAndPassword(email, password);
          const user = userCredential.user;

          const userDoc = await db.collection('users').doc(user.uid).get();
          if (!userDoc.exists) {
            await auth.signOut();
            setError('User profile not found.');
            setLoading(false);
            return;
          }

          const userData = userDoc.data();
          if (userData.status === 'pending') {
            await auth.signOut();
            setError('Your account is pending approval.');
            setLoading(false);
            return;
          }

          if (userData.status === 'rejected') {
            await auth.signOut();
            setError('Your account has been rejected.');
            setLoading(false);
            return;
          }
        } catch (err) {
          setError(err.message);
          setLoading(false);
        }
      };

      const handleLogout = async () => {
        try {
          await auth.signOut();
          setEmail('');
          setPassword('');
          setName('');
          setBikeName('');
          setBikeModel('');
          setActiveTab('dashboard');
        } catch (err) {
          setError(err.message);
        }
      };

      const approveUser = async (userId) => {
        try {
          await db.collection('users').doc(userId).update({
            status: 'approved',
            approvedAt: new Date().toISOString()
          });
          setSuccess('User approved successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const rejectUser = async (userId) => {
        if (!window.confirm('Are you sure you want to reject this user?')) return;
        try {
          await db.collection('users').doc(userId).update({
            status: 'rejected',
            rejectedAt: new Date().toISOString()
          });
          setSuccess('User rejected.');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError(err.message);
        }
      };

      const getCurrentOdometer = () => {
        return activeBike?.currentOdometer || 0;
      };

      const calculateAverageMileage = () => {
        if (fuelEntries.length < 2) return 0;
        
        let totalKm = 0;
        let totalLiters = 0;
        
        fuelEntries.forEach(entry => {
          if (entry.entryType === 'startEnd') {
            totalKm += (entry.endKm - entry.startKm);
          } else {
            totalKm += entry.totalKm;
          }
          totalLiters += entry.liters;
        });
        
        return totalLiters > 0 ? (totalKm / totalLiters).toFixed(2) : 0;
      };

      const totalTrips = trips.length;
      const totalKmTraveled = trips.reduce((sum, t) => sum + (t.kilometers || 0), 0);
      const totalFuelCost = fuelEntries.reduce((sum, f) => sum + (f.cost || 0), 0);
      const totalFuelLiters = fuelEntries.reduce((sum, f) => sum + (f.liters || 0), 0);
      const avgMileage = calculateAverageMileage();
      const currentOdometer = getCurrentOdometer();
      const activeIssues = issues.filter(i => i.status !== 'fixed').length;

      // Loading screen
      if (loading && !currentUser) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <Icon name="loader" size={48} className="text-indigo-600 mx-auto mb-4" />
              <p className="text-gray-600">Loading...</p>
            </div>
          </div>
        );
      }

      // Auth screens
      if (!currentUser) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="glassmorphism rounded-3xl shadow-2xl p-8 w-full max-w-md border border-white/20">
              <div className="text-center mb-8">
                <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl mb-4 shadow-lg">
                  <Icon name="bike" size={32} className="text-white" />
                </div>
                <h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                  Bike Tracker
                </h1>
                <p className="text-gray-600 mt-2">Complete bike management solution</p>
              </div>

              {success && (
                <div className="bg-green-50 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-lg mb-4 slide-in">
                  <div className="flex items-start">
                    <Icon name="check" size={20} className="mr-2 mt-0.5" />
                    <span className="text-sm">{success}</span>
                  </div>
                </div>
              )}

              {error && (
                <div className="bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg mb-4 slide-in">
                  <div className="flex items-start">
                    <Icon name="alert" size={20} className="mr-2 mt-0.5" />
                    <span className="text-sm">{error}</span>
                  </div>
                </div>
              )}

              {authMode === 'pending' ? (
                <div className="text-center py-8">
                  <div className="inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-full mb-4">
                    <Icon name="check" size={32} className="text-yellow-600" />
                  </div>
                  <h2 className="text-xl font-semibold text-gray-800 mb-2">Registration Submitted!</h2>
                  <p className="text-gray-600 mb-6">Your account is pending admin approval.</p>
                  <button
                    onClick={() => { setAuthMode('login'); setSuccess(''); setError(''); }}
                    className="text-indigo-600 hover:text-indigo-700 font-medium"
                  >
                    Back to Login
                  </button>
                </div>
              ) : (
                <>
                  <div className="flex border-b-2 mb-6">
                    <button
                      onClick={() => { setAuthMode('login'); setError(''); setSuccess(''); }}
                      className={`flex-1 py-3 text-center font-semibold transition-all ${
                        authMode === 'login'
                          ? 'text-indigo-600 border-b-2 border-indigo-600 -mb-0.5'
                          : 'text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      Login
                    </button>
                    <button
                      onClick={() => { setAuthMode('register'); setError(''); setSuccess(''); }}
                      className={`flex-1 py-3 text-center font-semibold transition-all ${
                        authMode === 'register'
                          ? 'text-indigo-600 border-b-2 border-indigo-600 -mb-0.5'
                          : 'text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      Register
                    </button>
                  </div>

                  <form onSubmit={authMode === 'login' ? handleLogin : handleRegister} className="space-y-4">
                    {authMode === 'register' && (
                      <>
                        <div>
                          <label className="block text-gray-700 font-medium mb-2 text-sm">Your Name</label>
                          <input
                            type="text"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="Enter your name"
                            required
                          />
                        </div>

                        <div>
                          <label className="block text-gray-700 font-medium mb-2 text-sm">Bike Name (Optional)</label>
                          <input
                            type="text"
                            value={bikeName}
                            onChange={(e) => setBikeName(e.target.value)}
                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="e.g., Pulsar, Royal Enfield"
                          />
                        </div>

                        <div>
                          <label className="block text-gray-700 font-medium mb-2 text-sm">Bike Model (Optional)</label>
                          <input
                            type="text"
                            value={bikeModel}
                            onChange={(e) => setBikeModel(e.target.value)}
                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="e.g., NS200, Classic 350"
                          />
                        </div>
                      </>
                    )}

                    <div>
                      <label className="block text-gray-700 font-medium mb-2 text-sm">Email</label>
                      <input
                        type="email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                        placeholder="your@email.com"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-gray-700 font-medium mb-2 text-sm">Password</label>
                      <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                        placeholder="Min 6 characters"
                        required
                        minLength="6"
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                    >
                      {loading ? <Icon name="loader" size={20} /> : (authMode === 'login' ? 'Login' : 'Create Account')}
                    </button>
                  </form>
                </>
              )}
            </div>
          </div>
        );
      }

      // Main App - Logged In
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
          {/* Header */}
          <header className="glassmorphism shadow-lg sticky top-0 z-50 border-b border-white/20">
            <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center space-x-3">
                <div className="bg-gradient-to-br from-indigo-600 to-purple-600 p-2 rounded-xl shadow-lg">
                  <Icon name="bike" size={24} className="text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold text-gray-800">
                    {activeBike ? `${activeBike.bikeName} ${activeBike.bikeModel}` : 'Bike Tracker'}
                  </h1>
                  <p className="text-xs text-gray-500">Odometer: {currentOdometer} km</p>
                </div>
              </div>
              <div className="flex items-center space-x-4">
                <div className="hidden md:block text-right">
                  <p className="text-sm font-medium text-gray-800">{userProfile?.name}</p>
                  <p className="text-xs text-gray-500">{isAdmin ? 'Admin' : 'User'}</p>
                </div>
                <button
                  onClick={handleLogout}
                  className="p-2 text-gray-600 hover:text-red-600 transition-colors rounded-lg hover:bg-red-50"
                  title="Logout"
                >
                  <Icon name="logout" size={20} />
                </button>
              </div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-4 py-6">
            {/* Messages */}
            {success && (
              <div className="bg-green-50 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-lg mb-4 slide-in">
                <div className="flex items-start">
                  <Icon name="check" size={20} className="mr-2 mt-0.5" />
                  <span className="text-sm">{success}</span>
                </div>
              </div>
            )}
            
            {error && (
              <div className="bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg mb-4 slide-in">
                <div className="flex items-start">
                  <Icon name="alert" size={20} className="mr-2 mt-0.5" />
                  <span className="text-sm">{error}</span>
                </div>
              </div>
            )}

            {/* Navigation */}
            <div className="glassmorphism rounded-2xl shadow-lg mb-6 overflow-x-auto border border-white/20">
              <div className="flex">
                <button
                  onClick={() => setActiveTab('dashboard')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 transition-all ${
                    activeTab === 'dashboard'
                      ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                  }`}
                >
                  <Icon name="chart" size={18} />
                  <span className="hidden sm:inline">Dashboard</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('addTrip')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 transition-all ${
                    activeTab === 'addTrip'
                      ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                  }`}
                >
                  <Icon name="map" size={18} />
                  <span>Add Trip</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('addFuel')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 transition-all ${
                    activeTab === 'addFuel'
                      ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                  }`}
                >
                  <Icon name="fuel" size={18} />
                  <span>Add Fuel</span>
                </button>

                <button
                  onClick={() => setActiveTab('trips')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap transition-all ${
                    activeTab === 'trips'
                      ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                  }`}
                >
                  Trips ({totalTrips})
                </button>

                <button
                  onClick={() => setActiveTab('fuel')}
                  className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap transition-all ${
                    activeTab === 'fuel'
                      ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                  }`}
                >
                  Fuel ({fuelEntries.length})
                </button>

                {userProfile?.features?.issueTrackingEnabled && (
                  <button
                    onClick={() => setActiveTab('issues')}
                    className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 transition-all ${
                      activeTab === 'issues'
                        ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                        : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                    }`}
                  >
                    <Icon name="alert" size={18} />
                    <span>Issues {activeIssues > 0 && `(${activeIssues})`}</span>
                  </button>
                )}

                {isAdmin && (
                  <button
                    onClick={() => setActiveTab('users')}
                    className={`px-4 md:px-6 py-3 font-medium whitespace-nowrap flex items-center space-x-2 transition-all ${
                      activeTab === 'users'
                        ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50'
                        : 'text-gray-600 hover:text-gray-800 hover:bg-gray-50/50'
                    }`}
                  >
                    <Icon name="users" size={18} />
                    <span>Users {pendingUsers.length > 0 && `(${pendingUsers.length})`}</span>
                  </button>
                )}
              </div>
            </div>

            {/* Dashboard */}
            {activeTab === 'dashboard' && (
              <div className="space-y-6">
                {/* Stats Grid */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20 hover:shadow-xl transition-shadow">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="text-gray-600 text-sm font-semibold uppercase tracking-wide">Avg Mileage</h3>
                      <div className="p-2 bg-green-100 rounded-lg">
                        <Icon name="trending" size={20} className="text-green-600" />
                      </div>
                    </div>
                    <p className="text-4xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                      {avgMileage}
                    </p>
                    <p className="text-sm text-gray-500 mt-1">km/liter</p>
                    {fuelEntries.length > 0 && (
                      <p className="text-xs text-gray-400 mt-2">Based on {fuelEntries.length} fills</p>
                    )}
                  </div>

                  <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20 hover:shadow-xl transition-shadow">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="text-gray-600 text-sm font-semibold uppercase tracking-wide">Total Trips</h3>
                      <div className="p-2 bg-blue-100 rounded-lg">
                        <Icon name="map" size={20} className="text-blue-600" />
                      </div>
                    </div>
                    <p className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                      {totalTrips}
                    </p>
                    <p className="text-sm text-gray-500 mt-1">{totalKmTraveled.toFixed(1)} km traveled</p>
                  </div>

                  <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20 hover:shadow-xl transition-shadow">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="text-gray-600 text-sm font-semibold uppercase tracking-wide">Fuel Used</h3>
                      <div className="p-2 bg-orange-100 rounded-lg">
                        <Icon name="fuel" size={20} className="text-orange-600" />
                      </div>
                    </div>
                    <p className="text-4xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                      {totalFuelLiters.toFixed(1)}
                    </p>
                    <p className="text-sm text-gray-500 mt-1">liters</p>
                  </div>

                  <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20 hover:shadow-xl transition-shadow">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="text-gray-600 text-sm font-semibold uppercase tracking-wide">Total Cost</h3>
                      <div className="p-2 bg-purple-100 rounded-lg">
                        <span className="text-purple-600 font-bold text-xl">₹</span>
                      </div>
                    </div>
                    <p className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                      ₹{totalFuelCost.toFixed(0)}
                    </p>
                    <p className="text-sm text-gray-500 mt-1">fuel expenses</p>
                  </div>
                </div>

                {/* Active Issues Alert */}
                {activeIssues > 0 && userProfile?.features?.issueTrackingEnabled && (
                  <div className="glassmorphism rounded-2xl shadow-lg p-6 border-l-4 border-red-500 border border-white/20">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start space-x-3">
                        <Icon name="alert" size={24} className="text-red-600 mt-1" />
                        <div>
                          <h3 className="text-lg font-semibold text-gray-800 mb-1">
                            {activeIssues} Active Issue{activeIssues > 1 ? 's' : ''}
                          </h3>
                          <p className="text-sm text-gray-600">
                            You have {activeIssues} bike issue{activeIssues > 1 ? 's' : ''} that need{activeIssues === 1 ? 's' : ''} attention.
                          </p>
                        </div>
                      </div>
                      <button
                        onClick={() => setActiveTab('issues')}
                        className="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 transition-colors"
                      >
                        View Issues
                      </button>
                    </div>
                  </div>
                )}

                {/* Recent Activity */}
                <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20">
                  <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <Icon name="list" size={24} className="mr-2" />
                    Recent Activity
                  </h2>
                  {trips.length === 0 && fuelEntries.length === 0 ? (
                    <div className="text-center py-12">
                      <Icon name="map" size={48} className="text-gray-300 mx-auto mb-4" />
                      <p className="text-gray-500">No activity yet. Start by adding your first trip!</p>
                      <button
                        onClick={() => setActiveTab('addTrip')}
                        className="mt-4 px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg"
                      >
                        Add First Trip
                      </button>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {trips.slice(0, 5).map(trip => (
                        <div key={trip.id} className="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl hover:shadow-md transition-shadow border border-blue-100">
                          <div className="flex items-center space-x-3">
                            <div className="p-2 bg-blue-100 rounded-lg">
                              <Icon name="map" size={20} className="text-blue-600" />
                            </div>
                            <div>
                              <p className="font-semibold text-gray-800">{trip.source} → {trip.destination}</p>
                              <p className="text-sm text-gray-500">{new Date(trip.date).toLocaleString()}</p>
                            </div>
                          </div>
                          <div className="text-right">
                            <p className="font-bold text-indigo-600">{trip.kilometers} km</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* User Management (Admin) */}
            {activeTab === 'users' && isAdmin && (
              <div className="glassmorphism rounded-2xl shadow-lg p-6 border border-white/20">
                <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                  <Icon name="users" size={28} className="mr-2" />
                  User Management
                </h2>
                
                {pendingUsers.length > 0 ? (
                  <div className="space-y-4">
                    <h3 className="text-lg font-semibold text-gray-700 mb-4">Pending Approvals</h3>
                    {pendingUsers.map(user => (
                      <div key={user.id} className="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 border-l-4 border-yellow-500 bg-yellow-50 rounded-xl gap-3">
                        <div>
                          <p className="font-semibold text-gray-800">{user.name}</p>
                          <p className="text-sm text-gray-600">{user.email}</p>
                          <p className="text-xs text-gray-500 mt-1">Registered: {new Date(user.createdAt).toLocaleDateString()}</p>
                        </div>
                        <div className="flex space-x-2">
                          <button
                            onClick={() => approveUser(user.id)}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-1 font-medium"
                          >
                            <Icon name="check" size={16} />
                            <span>Approve</span>
                          </button>
                          <button
                            onClick={() => rejectUser(user.id)}
                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-1 font-medium"
                          >
                            <Icon name="x" size={16} />
                            <span>Reject</span>
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-center py-12">
                    <Icon name="users" size={48} className="text-gray-300 mx-auto mb-4" />
                    <p className="text-gray-500">No pending user requests</p>
                  </div>
                )}

                <div className="mt-8 p-4 bg-blue-50 rounded-xl border border-blue-200">
                  <h4 className="font-semibold text-blue-900 mb-2 flex items-center">
                    <Icon name="alert" size={20} className="mr-2" />
                    Admin Info
                  </h4>
                  <p className="text-sm text-blue-800">You can approve or reject user registration requests here.</p>
                  <p className="text-sm text-blue-800 mt-1">Approved users will be able to login and track their bike data.</p>
                </div>
              </div>
            )}

            {/* Coming Soon Placeholder for other tabs */}
            {['addTrip', 'addFuel', 'trips', 'fuel', 'issues'].includes(activeTab) && (
              <div className="glassmorphism rounded-2xl shadow-lg p-12 border border-white/20 text-center">
                <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl mb-6 shadow-lg">
                  <Icon name="wrench" size={32} className="text-white" />
                </div>
                <h2 className="text-3xl font-bold text-gray-800 mb-4">
                  {activeTab === 'addTrip' && 'Add Trip'}
                  {activeTab === 'addFuel' && 'Add Fuel'}
                  {activeTab === 'trips' && 'Trip History'}
                  {activeTab === 'fuel' && 'Fuel History'}
                  {activeTab === 'issues' && 'Issue Tracker'}
                </h2>
                <p className="text-gray-600 mb-6 max-w-md mx-auto">
                  This feature is being implemented with all the enhancements we discussed.
                  It will include:
                </p>
                <div className="text-left max-w-md mx-auto space-y-2 mb-8">
                  {activeTab === 'addTrip' && (
                    <>
                      <p className="text-sm text-gray-600">• Three entry methods (Manual/Trip Meter/Odometer)</p>
                      <p className="text-sm text-gray-600">• Automatic odometer sync</p>
                      <p className="text-sm text-gray-600">• Notes and timestamps</p>
                    </>
                  )}
                  {activeTab === 'addFuel' && (
                    <>
                      <p className="text-sm text-gray-600">• Smart auto-recall of last fill</p>
                      <p className="text-sm text-gray-600">• No partial fill checkbox (simplified!)</p>
                      <p className="text-sm text-gray-600">• Automatic distance calculation</p>
                    </>
                  )}
                  {activeTab === 'issues' && (
                    <>
                      <p className="text-sm text-gray-600">• Report and track bike issues</p>
                      <p className="text-sm text-gray-600">• Status workflow (Open → Informed → Fixed)</p>
                      <p className="text-sm text-gray-600">• Timeline and cost tracking</p>
                    </>
                  )}
                </div>
                <div className="inline-flex items-center space-x-2 text-indigo-600">
                  <Icon name="loader" size={20} />
                  <span className="font-medium">Full implementation in progress...</span>
                </div>
              </div>
            )}
          </div>

          {/* Footer */}
          <footer className="glassmorphism border-t border-white/20 mt-12 py-6">
            <div className="max-w-7xl mx-auto px-4 text-center">
              <p className="text-sm text-gray-600">
                Bike Tracker v2.0 • Complete Management Solution
              </p>
              <p className="text-xs text-gray-500 mt-1">
                Connected to: {firebaseConfig.projectId}
              </p>
            </div>
          </footer>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BikeTrackerApp />);
  </script>
</body>
</html>
